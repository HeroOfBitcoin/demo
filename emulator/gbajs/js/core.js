class ARMCore{constructor(){this.SP=13,this.LR=14,this.PC=15,this.MODE_ARM=0,this.MODE_THUMB=1,this.MODE_USER=16,this.MODE_FIQ=17,this.MODE_IRQ=18,this.MODE_SUPERVISOR=19,this.MODE_ABORT=23,this.MODE_UNDEFINED=27,this.MODE_SYSTEM=31,this.BANK_NONE=0,this.BANK_FIQ=1,this.BANK_IRQ=2,this.BANK_SUPERVISOR=3,this.BANK_ABORT=4,this.BANK_UNDEFINED=5,this.UNALLOC_MASK=268435200,this.USER_MASK=4026531840,this.PRIV_MASK=207,this.STATE_MASK=32,this.WORD_SIZE_ARM=4,this.WORD_SIZE_THUMB=2,this.BASE_RESET=0,this.BASE_UNDEF=4,this.BASE_SWI=8,this.BASE_PABT=12,this.BASE_DABT=16,this.BASE_IRQ=24,this.BASE_FIQ=28,this.armCompiler=new ARMCoreArm(this),this.thumbCompiler=new ARMCoreThumb(this),this.generateConds(),this.gprs=new Int32Array(16)}resetCPU(d){for(var c=0,a,b;c<this.PC;++c)this.gprs[c]=0;this.gprs[this.PC]=d+this.WORD_SIZE_ARM,this.loadInstruction=this.loadInstructionArm,this.execMode=this.MODE_ARM,this.instructionWidth=this.WORD_SIZE_ARM,this.mode=this.MODE_SYSTEM,this.cpsrI=!1,this.cpsrF=!1,this.cpsrV=!1,this.cpsrC=!1,this.cpsrZ=!1,this.cpsrN=!1,this.bankedRegisters=[new Int32Array(7),new Int32Array(7),new Int32Array(2),new Int32Array(2),new Int32Array(2),new Int32Array(2)],this.spsr=0,this.bankedSPSRs=new Int32Array(6),this.cycles=0,this.shifterOperand=0,this.shifterCarryOut=0,this.page=null,this.pageId=0,this.pageRegion=-1,this.instruction=null,this.irq.clear(),a=this.gprs,b=this.mmu,this.step=function(){var c=this.instruction||(this.instruction=this.loadInstruction(a[this.PC]-this.instructionWidth)),d;a[this.PC]+=this.instructionWidth,this.conditionPassed=!0,c(),c.writesPC?this.conditionPassed?(d=a[this.PC]&=4294967294,this.execMode==this.MODE_ARM?(b.wait32(d),b.waitPrefetch32(d)):(b.wait(d),b.waitPrefetch(d)),a[this.PC]+=this.instructionWidth,c.fixedJump?this.instruction!=null&&((c.next==null||c.next.page.invalid)&&(c.next=this.loadInstruction(a[this.PC]-this.instructionWidth)),this.instruction=c.next):this.instruction=null):this.instruction=null:this.instruction!=null&&((c.next==null||c.next.page.invalid)&&(c.next=this.loadInstruction(a[this.PC]-this.instructionWidth)),this.instruction=c.next),this.irq.updateTimers()}}freeze(){return{gprs:[this.gprs[0],this.gprs[1],this.gprs[2],this.gprs[3],this.gprs[4],this.gprs[5],this.gprs[6],this.gprs[7],this.gprs[8],this.gprs[9],this.gprs[10],this.gprs[11],this.gprs[12],this.gprs[13],this.gprs[14],this.gprs[15]],mode:this.mode,cpsrI:this.cpsrI,cpsrF:this.cpsrF,cpsrV:this.cpsrV,cpsrC:this.cpsrC,cpsrZ:this.cpsrZ,cpsrN:this.cpsrN,bankedRegisters:[[this.bankedRegisters[0][0],this.bankedRegisters[0][1],this.bankedRegisters[0][2],this.bankedRegisters[0][3],this.bankedRegisters[0][4],this.bankedRegisters[0][5],this.bankedRegisters[0][6]],[this.bankedRegisters[1][0],this.bankedRegisters[1][1],this.bankedRegisters[1][2],this.bankedRegisters[1][3],this.bankedRegisters[1][4],this.bankedRegisters[1][5],this.bankedRegisters[1][6]],[this.bankedRegisters[2][0],this.bankedRegisters[2][1]],[this.bankedRegisters[3][0],this.bankedRegisters[3][1]],[this.bankedRegisters[4][0],this.bankedRegisters[4][1]],[this.bankedRegisters[5][0],this.bankedRegisters[5][1]]],spsr:this.spsr,bankedSPSRs:[this.bankedSPSRs[0],this.bankedSPSRs[1],this.bankedSPSRs[2],this.bankedSPSRs[3],this.bankedSPSRs[4],this.bankedSPSRs[5]],cycles:this.cycles}}defrost(a){this.instruction=null,this.page=null,this.pageId=0,this.pageRegion=-1,this.gprs[0]=a.gprs[0],this.gprs[1]=a.gprs[1],this.gprs[2]=a.gprs[2],this.gprs[3]=a.gprs[3],this.gprs[4]=a.gprs[4],this.gprs[5]=a.gprs[5],this.gprs[6]=a.gprs[6],this.gprs[7]=a.gprs[7],this.gprs[8]=a.gprs[8],this.gprs[9]=a.gprs[9],this.gprs[10]=a.gprs[10],this.gprs[11]=a.gprs[11],this.gprs[12]=a.gprs[12],this.gprs[13]=a.gprs[13],this.gprs[14]=a.gprs[14],this.gprs[15]=a.gprs[15],this.mode=a.mode,this.cpsrI=a.cpsrI,this.cpsrF=a.cpsrF,this.cpsrV=a.cpsrV,this.cpsrC=a.cpsrC,this.cpsrZ=a.cpsrZ,this.cpsrN=a.cpsrN,this.bankedRegisters[0][0]=a.bankedRegisters[0][0],this.bankedRegisters[0][1]=a.bankedRegisters[0][1],this.bankedRegisters[0][2]=a.bankedRegisters[0][2],this.bankedRegisters[0][3]=a.bankedRegisters[0][3],this.bankedRegisters[0][4]=a.bankedRegisters[0][4],this.bankedRegisters[0][5]=a.bankedRegisters[0][5],this.bankedRegisters[0][6]=a.bankedRegisters[0][6],this.bankedRegisters[1][0]=a.bankedRegisters[1][0],this.bankedRegisters[1][1]=a.bankedRegisters[1][1],this.bankedRegisters[1][2]=a.bankedRegisters[1][2],this.bankedRegisters[1][3]=a.bankedRegisters[1][3],this.bankedRegisters[1][4]=a.bankedRegisters[1][4],this.bankedRegisters[1][5]=a.bankedRegisters[1][5],this.bankedRegisters[1][6]=a.bankedRegisters[1][6],this.bankedRegisters[2][0]=a.bankedRegisters[2][0],this.bankedRegisters[2][1]=a.bankedRegisters[2][1],this.bankedRegisters[3][0]=a.bankedRegisters[3][0],this.bankedRegisters[3][1]=a.bankedRegisters[3][1],this.bankedRegisters[4][0]=a.bankedRegisters[4][0],this.bankedRegisters[4][1]=a.bankedRegisters[4][1],this.bankedRegisters[5][0]=a.bankedRegisters[5][0],this.bankedRegisters[5][1]=a.bankedRegisters[5][1],this.spsr=a.spsr,this.bankedSPSRs[0]=a.bankedSPSRs[0],this.bankedSPSRs[1]=a.bankedSPSRs[1],this.bankedSPSRs[2]=a.bankedSPSRs[2],this.bankedSPSRs[3]=a.bankedSPSRs[3],this.bankedSPSRs[4]=a.bankedSPSRs[4],this.bankedSPSRs[5]=a.bankedSPSRs[5],this.cycles=a.cycles}fetchPage(c){var a=c>>this.mmu.BASE_OFFSET,b=this.mmu.addressToPage(a,c&this.mmu.OFFSET_MASK);if(a==this.pageRegion){if(b==this.pageId&&!this.page.invalid)return;this.pageId=b}else this.pageMask=this.mmu.memory[a].PAGE_MASK,this.pageRegion=a,this.pageId=b;this.page=this.mmu.accessPage(a,b)}loadInstructionArm(b){var a=null,c,d;return this.fetchPage(b),c=(b&this.pageMask)>>2,a=this.page.arm[c],a||(d=this.mmu.load32(b)>>>0,a=this.compileArm(d),a.next=null,a.page=this.page,a.address=b,a.opcode=d,this.page.arm[c]=a,a)}loadInstructionThumb(b){var a=null,c,d;return this.fetchPage(b),c=(b&this.pageMask)>>1,a=this.page.thumb[c],a||(d=this.mmu.load16(b),a=this.compileThumb(d),a.next=null,a.page=this.page,a.address=b,a.opcode=d,this.page.thumb[c]=a,a)}selectBank(a){switch(a){case this.MODE_USER:case this.MODE_SYSTEM:return this.BANK_NONE;case this.MODE_FIQ:return this.BANK_FIQ;case this.MODE_IRQ:return this.BANK_IRQ;case this.MODE_SUPERVISOR:return this.BANK_SUPERVISOR;case this.MODE_ABORT:return this.BANK_ABORT;case this.MODE_UNDEFINED:return this.BANK_UNDEFINED;default:throw'Invalid user mode passed to selectBank'}}switchExecMode(a){this.execMode!=a&&(this.execMode=a,a==this.MODE_ARM?(this.instructionWidth=this.WORD_SIZE_ARM,this.loadInstruction=this.loadInstructionArm):(this.instructionWidth=this.WORD_SIZE_THUMB,this.loadInstruction=this.loadInstructionThumb))}switchMode(a){var b,c,d,e;if(a==this.mode)return;(a!=this.MODE_USER||a!=this.MODE_SYSTEM)&&(b=this.selectBank(a),c=this.selectBank(this.mode),b!=c&&((a==this.MODE_FIQ||this.mode==this.MODE_FIQ)&&(d=(c==this.BANK_FIQ)+0,e=(b==this.BANK_FIQ)+0,this.bankedRegisters[d][2]=this.gprs[8],this.bankedRegisters[d][3]=this.gprs[9],this.bankedRegisters[d][4]=this.gprs[10],this.bankedRegisters[d][5]=this.gprs[11],this.bankedRegisters[d][6]=this.gprs[12],this.gprs[8]=this.bankedRegisters[e][2],this.gprs[9]=this.bankedRegisters[e][3],this.gprs[10]=this.bankedRegisters[e][4],this.gprs[11]=this.bankedRegisters[e][5],this.gprs[12]=this.bankedRegisters[e][6]),this.bankedRegisters[c][0]=this.gprs[this.SP],this.bankedRegisters[c][1]=this.gprs[this.LR],this.gprs[this.SP]=this.bankedRegisters[b][0],this.gprs[this.LR]=this.bankedRegisters[b][1],this.bankedSPSRs[c]=this.spsr,this.spsr=this.bankedSPSRs[b])),this.mode=a}packCPSR(){return this.mode|!!this.execMode<<5|!!this.cpsrF<<6|!!this.cpsrI<<7|!!this.cpsrN<<31|!!this.cpsrZ<<30|!!this.cpsrC<<29|!!this.cpsrV<<28}unpackCPSR(a){this.switchMode(a&31),this.switchExecMode(!!(a&32)),this.cpsrF=a&64,this.cpsrI=a&128,this.cpsrN=a&2147483648,this.cpsrZ=a&1073741824,this.cpsrC=a&536870912,this.cpsrV=a&268435456,this.irq.testIRQ()}hasSPSR(){return this.mode!=this.MODE_SYSTEM&&this.mode!=this.MODE_USER}raiseIRQ(){var a,b;if(this.cpsrI)return;a=this.packCPSR(),b=this.instructionWidth,this.switchMode(this.MODE_IRQ),this.spsr=a,this.gprs[this.LR]=this.gprs[this.PC]-b+4,this.gprs[this.PC]=this.BASE_IRQ+this.WORD_SIZE_ARM,this.instruction=null,this.switchExecMode(this.MODE_ARM),this.cpsrI=!0}raiseTrap(){var a=this.packCPSR(),b=this.instructionWidth;this.switchMode(this.MODE_SUPERVISOR),this.spsr=a,this.gprs[this.LR]=this.gprs[this.PC]-b,this.gprs[this.PC]=this.BASE_SWI+this.WORD_SIZE_ARM,this.instruction=null,this.switchExecMode(this.MODE_ARM),this.cpsrI=!0}badOp(b){var a=function(){throw'Illegal instruction: 0x'+b.toString(16)};return a.writesPC=!0,a.fixedJump=!1,a}generateConds(){var a=this;this.conds=[function(){return a.conditionPassed=a.cpsrZ},function(){return a.conditionPassed=!a.cpsrZ},function(){return a.conditionPassed=a.cpsrC},function(){return a.conditionPassed=!a.cpsrC},function(){return a.conditionPassed=a.cpsrN},function(){return a.conditionPassed=!a.cpsrN},function(){return a.conditionPassed=a.cpsrV},function(){return a.conditionPassed=!a.cpsrV},function(){return a.conditionPassed=a.cpsrC&&!a.cpsrZ},function(){return a.conditionPassed=!a.cpsrC||a.cpsrZ},function(){return a.conditionPassed=!a.cpsrN==!a.cpsrV},function(){return a.conditionPassed=!a.cpsrN!=!a.cpsrV},function(){return a.conditionPassed=!a.cpsrZ&&!a.cpsrN==!a.cpsrV},function(){return a.conditionPassed=a.cpsrZ||!a.cpsrN!=!a.cpsrV},null,null]}barrelShiftImmediate(f,d,b){var a=this,c=this.gprs,e=this.badOp;switch(f){case 0:d?e=function(){a.shifterOperand=c[b]<<d,a.shifterCarryOut=c[b]&1<<32-d}:e=function(){a.shifterOperand=c[b],a.shifterCarryOut=a.cpsrC};break;case 32:d?e=function(){a.shifterOperand=c[b]>>>d,a.shifterCarryOut=c[b]&1<<d-1}:e=function(){a.shifterOperand=0,a.shifterCarryOut=c[b]&2147483648};break;case 64:d?e=function(){a.shifterOperand=c[b]>>d,a.shifterCarryOut=c[b]&1<<d-1}:e=function(){a.shifterCarryOut=c[b]&2147483648,a.shifterCarryOut?a.shifterOperand=4294967295:a.shifterOperand=0};break;case 96:d?e=function(){a.shifterOperand=c[b]>>>d|c[b]<<32-d,a.shifterCarryOut=c[b]&1<<d-1}:e=function(){a.shifterOperand=!!a.cpsrC<<31|c[b]>>>1,a.shifterCarryOut=c[b]&1};break}return e}compileArm(b){var a=this.badOp(b),l=b&234881024,H=this,G=this.gprs,c=this.conds[(b&4026531840)>>>28],g,x,k,E,t,h,s,d,e,o,f,z,i,p,C,B,w,q,j,y,A,m,u,D,v,r,n,F;if((b&268435440)==19922704)g=b&15,a=this.armCompiler.constructBX(g,c),a.writesPC=!0,a.fixedJump=!1;else if(!(b&201326592)&&(l==33554432||(b&144)!=144))if(x=b&31457280,k=b&1048576,E=!1,(x&25165824)==16777216&&!k)t=b&4194304,(b&11595776)==2158592?(g=b&15,h=b&255,s=(b&3840)>>7,h=h>>>s|h<<32-s,a=this.armCompiler.constructMSR(g,t,b,h,c),a.writesPC=!1):(b&12517376)==983040&&(d=(b&61440)>>12,a=this.armCompiler.constructMRS(d,t,c),a.writesPC=d==this.PC);else{if(e=(b&983040)>>16,d=(b&61440)>>12,o=b&96,g=b&15,f=function(){throw'BUG: invalid barrel shifter'},b&33554432)h=b&255,z=(b&3840)>>7,z?f=this.armCompiler.constructAddressingMode1ImmediateRotate(h,z):f=this.armCompiler.constructAddressingMode1Immediate(h);else if(b&16)switch(i=(b&3840)>>8,E=!0,o){case 0:f=this.armCompiler.constructAddressingMode1LSL(i,g);break;case 32:f=this.armCompiler.constructAddressingMode1LSR(i,g);break;case 64:f=this.armCompiler.constructAddressingMode1ASR(i,g);break;case 96:f=this.armCompiler.constructAddressingMode1ROR(i,g);break}else h=(b&3968)>>7,f=this.barrelShiftImmediate(o,h,g);switch(x){case 0:k?a=this.armCompiler.constructANDS(d,e,f,c):a=this.armCompiler.constructAND(d,e,f,c);break;case 2097152:k?a=this.armCompiler.constructEORS(d,e,f,c):a=this.armCompiler.constructEOR(d,e,f,c);break;case 4194304:k?a=this.armCompiler.constructSUBS(d,e,f,c):a=this.armCompiler.constructSUB(d,e,f,c);break;case 6291456:k?a=this.armCompiler.constructRSBS(d,e,f,c):a=this.armCompiler.constructRSB(d,e,f,c);break;case 8388608:k?a=this.armCompiler.constructADDS(d,e,f,c):a=this.armCompiler.constructADD(d,e,f,c);break;case 10485760:k?a=this.armCompiler.constructADCS(d,e,f,c):a=this.armCompiler.constructADC(d,e,f,c);break;case 12582912:k?a=this.armCompiler.constructSBCS(d,e,f,c):a=this.armCompiler.constructSBC(d,e,f,c);break;case 14680064:k?a=this.armCompiler.constructRSCS(d,e,f,c):a=this.armCompiler.constructRSC(d,e,f,c);break;case 16777216:a=this.armCompiler.constructTST(d,e,f,c);break;case 18874368:a=this.armCompiler.constructTEQ(d,e,f,c);break;case 20971520:a=this.armCompiler.constructCMP(d,e,f,c);break;case 23068672:a=this.armCompiler.constructCMN(d,e,f,c);break;case 25165824:k?a=this.armCompiler.constructORRS(d,e,f,c):a=this.armCompiler.constructORR(d,e,f,c);break;case 27262976:k?a=this.armCompiler.constructMOVS(d,e,f,c):a=this.armCompiler.constructMOV(d,e,f,c);break;case 29360128:k?a=this.armCompiler.constructBICS(d,e,f,c):a=this.armCompiler.constructBIC(d,e,f,c);break;case 31457280:k?a=this.armCompiler.constructMVNS(d,e,f,c):a=this.armCompiler.constructMVN(d,e,f,c);break}a.writesPC=d==this.PC}else if((b&263196656)==16777360)g=b&15,d=b>>12&15,e=b>>16&15,b&4194304?a=this.armCompiler.constructSWPB(d,e,g,c):a=this.armCompiler.constructSWP(d,e,g,c),a.writesPC=d==this.PC;else switch(l){case 0:if((b&16777456)==144){switch(d=(b&983040)>>16,e=(b&61440)>>12,i=(b&3840)>>8,g=b&15,b&15728640){case 0:a=this.armCompiler.constructMUL(d,i,g,c);break;case 1048576:a=this.armCompiler.constructMULS(d,i,g,c);break;case 2097152:a=this.armCompiler.constructMLA(d,e,i,g,c);break;case 3145728:a=this.armCompiler.constructMLAS(d,e,i,g,c);break;case 8388608:a=this.armCompiler.constructUMULL(d,e,i,g,c);break;case 9437184:a=this.armCompiler.constructUMULLS(d,e,i,g,c);break;case 10485760:a=this.armCompiler.constructUMLAL(d,e,i,g,c);break;case 11534336:a=this.armCompiler.constructUMLALS(d,e,i,g,c);break;case 12582912:a=this.armCompiler.constructSMULL(d,e,i,g,c);break;case 13631488:a=this.armCompiler.constructSMULLS(d,e,i,g,c);break;case 14680064:a=this.armCompiler.constructSMLAL(d,e,i,g,c);break;case 15728640:a=this.armCompiler.constructSMLALS(d,e,i,g,c);break}a.writesPC=d==this.PC}else p=b&1048576,d=(b&61440)>>12,C=(b&3840)>>4,B=g=b&15,w=b&32,k=b&64,q=b&2097152,l=b&4194304,l?(h=B|C,j=this.armCompiler.constructAddressingMode23Immediate(b,h,c)):j=this.armCompiler.constructAddressingMode23Register(b,g,c),j.writesPC=!!q&&e==this.PC,(b&144)==144&&(p?w?k?a=this.armCompiler.constructLDRSH(d,j,c):a=this.armCompiler.constructLDRH(d,j,c):k&&(a=this.armCompiler.constructLDRSB(d,j,c)):!k&&w&&(a=this.armCompiler.constructSTRH(d,j,c))),a.writesPC=d==this.PC||j.writesPC;break;case 67108864:case 100663296:d=(b&61440)>>12,p=b&1048576,y=b&4194304,l=b&33554432,j=function(){throw'Unimplemented memory access: 0x'+b.toString(16)},~b&16777216&&(b&=4292870143),l?(g=b&15,o=b&96,A=(b&3968)>>7,o||A?(f=this.barrelShiftImmediate(o,A,g),j=this.armCompiler.constructAddressingMode2RegisterShifted(b,f,c)):j=this.armCompiler.constructAddressingMode23Register(b,g,c)):(m=b&4095,j=this.armCompiler.constructAddressingMode23Immediate(b,m,c)),p?y?a=this.armCompiler.constructLDRB(d,j,c):a=this.armCompiler.constructLDR(d,j,c):y?a=this.armCompiler.constructSTRB(d,j,c):a=this.armCompiler.constructSTR(d,j,c),a.writesPC=d==this.PC||j.writesPC;break;case 134217728:if(p=b&1048576,q=b&2097152,u=b&4194304,D=b&8388608,v=b&16777216,i=b&65535,e=(b&983040)>>16,h=0,m=0,r=!1,D){{v&&(h=4);for(n=1,l=0;l<16;n<<=1,++l)i&n&&(q&&l==e&&!m&&(i&=~n,h+=4,r=!0),m+=4)}}else{v||(h=4);for(n=1,l=0;l<16;n<<=1,++l)i&n&&(q&&l==e&&!m&&(i&=~n,h+=4,r=!0),h-=4,m-=4)}q?j=this.armCompiler.constructAddressingMode4Writeback(h,m,e,r):j=this.armCompiler.constructAddressingMode4(h,e),p?(u?a=this.armCompiler.constructLDMS(i,j,c):a=this.armCompiler.constructLDM(i,j,c),a.writesPC=!!(i&1<<15)):(u?a=this.armCompiler.constructSTMS(i,j,c):a=this.armCompiler.constructSTM(i,j,c),a.writesPC=!1);break;case 167772160:h=b&16777215,h&8388608&&(h|=4278190080),h<<=2,F=b&16777216,F?a=this.armCompiler.constructBL(h,c):a=this.armCompiler.constructB(h,c),a.writesPC=!0,a.fixedJump=!0;break;case 201326592:break;case 234881024:(b&251658240)==251658240&&(h=b&16777215,a=this.armCompiler.constructSWI(h,c),a.writesPC=!1);break;default:throw'Bad opcode: 0x'+b.toString(16)}return a.execMode=this.MODE_ARM,a.fixedJump=a.fixedJump||!1,a}compileThumb(b){var a=this.badOp(b&65535),q=this,p=this.gprs,e,c,f,m,d,l,h,i,j,g,k,n,o;if((b&64512)==16384){switch(e=(b&56)>>3,c=b&7,b&960){case 0:a=this.thumbCompiler.constructAND(c,e);break;case 64:a=this.thumbCompiler.constructEOR(c,e);break;case 128:a=this.thumbCompiler.constructLSL2(c,e);break;case 192:a=this.thumbCompiler.constructLSR2(c,e);break;case 256:a=this.thumbCompiler.constructASR2(c,e);break;case 320:a=this.thumbCompiler.constructADC(c,e);break;case 384:a=this.thumbCompiler.constructSBC(c,e);break;case 448:a=this.thumbCompiler.constructROR(c,e);break;case 512:a=this.thumbCompiler.constructTST(c,e);break;case 576:a=this.thumbCompiler.constructNEG(c,e);break;case 640:a=this.thumbCompiler.constructCMP2(c,e);break;case 704:a=this.thumbCompiler.constructCMN(c,e);break;case 768:a=this.thumbCompiler.constructORR(c,e);break;case 832:a=this.thumbCompiler.constructMUL(c,e);break;case 896:a=this.thumbCompiler.constructBIC(c,e);break;case 960:a=this.thumbCompiler.constructMVN(c,e);break}a.writesPC=!1}else if((b&64512)==17408)switch(e=(b&120)>>3,f=b&7,m=b&128,c=f|m>>4,b&768){case 0:a=this.thumbCompiler.constructADD4(c,e),a.writesPC=c==this.PC;break;case 256:a=this.thumbCompiler.constructCMP3(c,e),a.writesPC=!1;break;case 512:a=this.thumbCompiler.constructMOV3(c,e),a.writesPC=c==this.PC;break;case 768:a=this.thumbCompiler.constructBX(c,e),a.writesPC=!0,a.fixedJump=!1;break}else if((b&63488)==6144){switch(e=(b&448)>>6,f=(b&56)>>3,c=b&7,b&1536){case 0:a=this.thumbCompiler.constructADD3(c,f,e);break;case 512:a=this.thumbCompiler.constructSUB3(c,f,e);break;case 1024:d=(b&448)>>6,d?a=this.thumbCompiler.constructADD1(c,f,d):a=this.thumbCompiler.constructMOV2(c,f,e);break;case 1536:d=(b&448)>>6,a=this.thumbCompiler.constructSUB1(c,f,d);break}a.writesPC=!1}else if(b&57344)if((b&57344)==8192){switch(d=b&255,f=(b&1792)>>8,b&6144){case 0:a=this.thumbCompiler.constructMOV1(f,d);break;case 2048:a=this.thumbCompiler.constructCMP1(f,d);break;case 4096:a=this.thumbCompiler.constructADD2(f,d);break;case 6144:a=this.thumbCompiler.constructSUB2(f,d);break}a.writesPC=!1}else if((b&63488)==18432)c=(b&1792)>>8,d=(b&255)<<2,a=this.thumbCompiler.constructLDR3(c,d),a.writesPC=!1;else if((b&61440)==20480){switch(c=b&7,f=(b&56)>>3,e=(b&448)>>6,l=b&3584,l){case 0:a=this.thumbCompiler.constructSTR2(c,f,e);break;case 512:a=this.thumbCompiler.constructSTRH2(c,f,e);break;case 1024:a=this.thumbCompiler.constructSTRB2(c,f,e);break;case 1536:a=this.thumbCompiler.constructLDRSB(c,f,e);break;case 2048:a=this.thumbCompiler.constructLDR2(c,f,e);break;case 2560:a=this.thumbCompiler.constructLDRH2(c,f,e);break;case 3072:a=this.thumbCompiler.constructLDRB2(c,f,e);break;case 3584:a=this.thumbCompiler.constructLDRSH(c,f,e);break}a.writesPC=!1}else if((b&57344)==24576)c=b&7,f=(b&56)>>3,d=(b&1984)>>4,h=b&4096,h&&(d>>=2),i=b&2048,i?h?a=this.thumbCompiler.constructLDRB1(c,f,d):a=this.thumbCompiler.constructLDR1(c,f,d):h?a=this.thumbCompiler.constructSTRB1(c,f,d):a=this.thumbCompiler.constructSTR1(c,f,d),a.writesPC=!1;else if((b&62976)==46080)j=!!(b&256),g=b&255,b&2048?(a=this.thumbCompiler.constructPOP(g,j),a.writesPC=j,a.fixedJump=!1):(a=this.thumbCompiler.constructPUSH(g,j),a.writesPC=!1);else if(b&32768)switch(b&28672){case 0:c=b&7,f=(b&56)>>3,d=(b&1984)>>5,b&2048?a=this.thumbCompiler.constructLDRH1(c,f,d):a=this.thumbCompiler.constructSTRH1(c,f,d),a.writesPC=!1;break;case 4096:c=(b&1792)>>8,d=(b&255)<<2,i=b&2048,i?a=this.thumbCompiler.constructLDR4(c,d):a=this.thumbCompiler.constructSTR3(c,d),a.writesPC=!1;break;case 8192:c=(b&1792)>>8,d=(b&255)<<2,b&2048?a=this.thumbCompiler.constructADD6(c,d):a=this.thumbCompiler.constructADD5(c,d),a.writesPC=!1;break;case 12288:b&3840||(h=b&128,d=(b&127)<<2,h&&(d=-d),a=this.thumbCompiler.constructADD7(d),a.writesPC=!1);break;case 16384:f=(b&1792)>>8,g=b&255,b&2048?a=this.thumbCompiler.constructLDMIA(f,g):a=this.thumbCompiler.constructSTMIA(f,g),a.writesPC=!1;break;case 20480:k=(b&3840)>>8,d=b&255,k==15?(a=this.thumbCompiler.constructSWI(d),a.writesPC=!1):(b&128&&(d|=4294967040),d<<=1,n=this.conds[k],a=this.thumbCompiler.constructB1(d,n),a.writesPC=!0,a.fixedJump=!0);break;case 24576:case 28672:switch(d=b&2047,o=b&6144,o){case 0:d&1024&&(d|=4294965248),d<<=1,a=this.thumbCompiler.constructB2(d),a.writesPC=!0,a.fixedJump=!0;break;case 2048:break;case 4096:d&1024&&(d|=4294966272),d<<=12,a=this.thumbCompiler.constructBL1(d),a.writesPC=!1;break;case 6144:a=this.thumbCompiler.constructBL2(d),a.writesPC=!0,a.fixedJump=!1;break}break;default:this.WARN('Undefined instruction: 0x'+b.toString(16))}else throw'Bad opcode: 0x'+b.toString(16);else{switch(c=b&7,e=(b&56)>>3,d=(b&1984)>>6,b&6144){case 0:a=this.thumbCompiler.constructLSL1(c,e,d);break;case 2048:a=this.thumbCompiler.constructLSR1(c,e,d);break;case 4096:a=this.thumbCompiler.constructASR1(c,e,d);break;case 6144:break}a.writesPC=!1}return a.execMode=this.MODE_THUMB,a.fixedJump=a.fixedJump||!1,a}}